<script type="module">
  // Import Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.0/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.8.0/firebase-firestore.js";

  // Configuração Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyChRj15DTSVF9OMNFcQKF9rqsNappqN1z8",
    authDomain: "formulario-coleta.firebaseapp.com",
    projectId: "formulario-coleta",
    storageBucket: "formulario-coleta.appspot.com",
    messagingSenderId: "613221864969",
    appId: "1:613221864969:web:a0384c29ee005da6468ad8"
  };

  // Inicializar Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const form = document.getElementById('form-solicitacao');
  const mensagem = document.getElementById('mensagem-sucesso');

  form.addEventListener('submit', async function(e) {
    e.preventDefault();

    const solicitacao = {
      nota_fiscal: document.getElementById('nota_fiscal').value,
      valor_nota: parseFloat(document.getElementById('valor_nota').value),
      quantidade_volume: parseInt(document.getElementById('quantidade_volume').value),
      peso: parseFloat(document.getElementById('peso').value),
      data_coleta: document.getElementById('data_coleta').value,
      endereco_coleta: document.getElementById('endereco_coleta').value,
      endereco_destino: document.getElementById('endereco_destino').value,
      solicitante: document.getElementById('solicitante').value,
      observacoes: document.getElementById('observacoes').value,
      status: 'A coletar',
      criadoEm: serverTimestamp()
    };

    try {
      await addDoc(collection(db, 'coletas'), solicitacao);
      mensagem.textContent = "Solicitação enviada com sucesso!";
      form.reset();
      setTimeout(() => mensagem.textContent = '', 3000);
    } catch (error) {
      console.error("Erro ao enviar solicitação: ", error);
      mensagem.textContent = "Erro ao enviar. Tente novamente.";
    }
  });
</script>
